<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeFavoris ‚Äî Mes Favoris</title>
    <link rel="stylesheet" href="./assets/styles.css">
</head>
<body>
    <header>
        <button id="darkModeToggle">üåô Mode Sombre</button>
        <h1>AnimeFavoris ‚Äî Mes Favoris</h1>

        <div id="filters">
            <label for="yearSelect">Filtrer par ann√©e :</label>
            <select id="yearSelect">
                <option value="">Toutes</option>
                <option value="2026">2026</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2020">2020+</option>
                <option value="2015">2015+</option>
                <option value="2000">2000+</option>
            </select>

            <a href="./index.html" class="btn-link" id="backButton">‚Üê Retour √† la liste</a>
        </div>
    </header>

    <div id="favoritesCount" style="text-align:center;margin:20px;font-size:1.5rem;">
        Total Favoris : 0
    </div>

    <div class="container" id="animeFavori">
        <p style="text-align:center;margin:50px;">Chargement des favoris...</p>
    </div>

    <!-- Modale -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="animeTitle"></h2>
            <p id="animeDate"></p>
            <p id="animeRating"></p>
            <p id="animeGenres"></p>
            <img id="animeImage" src="" alt="Affiche de l'anime">
            <div class="modal-description">
                <h3>Description</h3>
                <p id="animeDescription"></p>
            </div>
        </div>
    </div>

    <!-- Scripts dans l'ordre correct -->
    <script src="./api/config.js"></script>
    <script src="./js/cookies.js"></script>
    <script src="./js/favoris.js"></script>
    <script src="./js/darkmods.js"></script>
    <script src="./js/animes.js"></script>
    <script src="./js/events.js"></script>

    <script>
        // Page favoris ‚Äî flag global + filtre ann√©e
        window.showFavoritesOnly = true;
        window.currentPage = 1;

        document.addEventListener("DOMContentLoaded", () => {
            const yearSelect = document.getElementById("yearSelect");
            if (yearSelect) {
                yearSelect.addEventListener("change", () => {
                    const selectedYear = yearSelect.value;
                    const animeFavori = document.getElementById("animeFavori");
                    if (!animeFavori || !window.favorites) return;

                    // Recharger et filtrer par ann√©e
                    const allCards = animeFavori.querySelectorAll(".anime-card");
                    allCards.forEach(card => {
                        const yearEl = card.querySelector(".anime-year");
                        if (!yearEl) return;
                        const cardYear = parseInt(yearEl.textContent.replace(/\D/g, ""));
                        if (!selectedYear || cardYear >= parseInt(selectedYear)) {
                            card.style.display = "";
                        } else {
                            card.style.display = "none";
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
